<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
</head>
<body>
    <div style="position: relative; ">
        <img id="image"src="test.png" style="top:0px; left:0px;">
        <div id = "app">
            <img src="gomibako.png" id="gomibako" width="150px" style="position: absolute; top:0px; left:0px; z-index: 1; background-color: white;"><br>
            <img src="ball.png" id="ball" width="80px" style="position: absolute; cursor: pointer; z-index: 2; top: 151px; left: 176px;">
        </div>
    <!--非表示にする部分-->
    <div id="button">
        <button class="button1">離す</button>
        <button class="button2">注ぐ</button>
        <button class="button3">運ぶ</button>
        <button class="button4">ミス</button>
    </div>
  <!--ここまで-->
    </div>
    <script>
        const button1 = document.querySelector('.button1');
        const button2 = document.querySelector('.button2');
        const button3 = document.querySelector('.button3');
        const button4 = document.querySelector('.button4');

        document.getElementById('button').style.visibility = 'hidden';
        var gomibako = document.getElementById("gomibako");
        gomibako.style.zIndex = "1";
        var ball = document.getElementById("ball");
        ball.style.position = "absolute";
        ball.style.cursor = "pointer";
        ball.style.zIndex = "2";
        ball.ondragstart = function(event){
          return false;
        }
    
        ball.onmousedown = function(event){
          document.addEventListener("mousemove",onMouseMove);
        }
    
        var onMouseMove = function(event){
          var x = event.clientX;
          var y = event.clientY;
          var width = ball.offsetWidth;
          var height = ball.offsetHeight;
          ball.style.top = (y-height/2) + "px";
          ball.style.left = (x-width/2) + "px";
          var gomibakoRect = gomibako.getBoundingClientRect();
          if((x>=gomibakoRect.left && x<=(gomibakoRect.left+gomibakoRect.width)) && (y>=gomibakoRect.top && y<=(gomibakoRect.top+gomibakoRect.height))){
            gomibako.style.backgroundColor = "pink";
          }
          else{
            gomibako.style.backgroundColor = "white";
          }
        }
    
        ball.onmouseup = function(event){
          var x = event.clientX;
          var y = event.clientY;
          var width = ball.offsetWidth;
          var height = ball.offsetHeight;
          var gomibakoRect = gomibako.getBoundingClientRect();
          if((x>=gomibakoRect.left && x<=(gomibakoRect.left+gomibakoRect.width)) && (y>=gomibakoRect.top && y<=(gomibakoRect.top+gomibakoRect.height))){
            x2 = x;
            y2 = y;
            var app = document.getElementById("app");
            gomibako.style.backgroundColor = "white";
            app.removeChild(ball);
        
            x_t = event.offsetX;
            y_t = event.offsetY + 10;
            document.getElementById('button').style.top = `${y}px`;
            document.getElementById('button').style.left = `${x}px`;
            document.getElementById('button').style.visibility = 'visible';
          }
          document.removeEventListener("mousemove",onMouseMove);
        }

        button1.addEventListener('click', () => {
            var text = "pos=" + 171 + ","+ 196 +","+ x2 + ","+ y2;
            console.log("submit", text)
            var request = new XMLHttpRequest();
            request.open("POST", "./", false);
            request.send(text) 
            window.location.href = 'thankyou.html'
        });
        button2.addEventListener('click', () => {
            window.location.href = 'thankyou.html'
        });
        button3.addEventListener('click', () => {
            window.location.href = 'thankyou.html'
        });

        button4.addEventListener('click', () => {
        ball.style.top = 151 + "px";
        ball.style.left = 176 + "px";
        var app = document.getElementById("app");
        app.appendChild(ball);
        document.getElementById('button').style.visibility = 'hidden';
        });
        
    </script>

</body>
</html>